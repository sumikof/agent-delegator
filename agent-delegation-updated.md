[['schemas/agent-interface.yaml](schemas/agent-interface.yaml) を参照。\n\n```\nAgent Interface\n├── Identity (id, name, role)\n├── Capabilities (実行可能なアクション)\n├── Responsibilities (must_do / must_not_do / may_do)\n├── Boundaries (ファイルアクセス制限)\n├── Language Policy (言語設定)\n├── Escalation (エスカレーション先)\n└── Execution Settings (timeout, retry)\n```\n\n### 3.2 ワークフローエンジン\n\nワークフローは YAML 設定ファイルで定義し、以下の機能を提供：\n\n- **ステージ定義**：順次実行・並列実行の制御\n- **ゲート判定**：各ステージ終了時の品質チェック\n- **エラーハンドリング**：リトライ、サーキットブレーカー、フォールバック\n- **タイムアウト管理**：グローバル・ステージ・エージェント単位\n\n詳細は [schemas/workflow-schema.yaml](schemas/workflow-schema.yaml) を参照。\n\n### 3.3 設定駆動アーキテクチャ\n\n```\nproject-config.yaml          # プロジェクト固有設定\n├── templates/xxx.yaml       # プロジェクトタイプ別テンプレート\n├── schemas/                 # スキーマ定義\n│   ├── workflow-schema.yaml\n│   └── agent-interface.yaml\n└── policies/                # 運用ポリシー\n    ├── language-policy.yaml\n    └── file-policy.yaml\n```\n\n---\n\n## 4. エージェントテンプレートシステム\n\n### 4.1 組み込みテンプレートカテゴリ\n\n| カテゴリ | 含まれるエージェント | 用途 |\n|----------|----------------------|------|\n| **core** | orchestrator, client-liaison, planner, progress, integrator | 全プロジェクト共通 |\n| **quality** | requirements-auditor, quality-auditor, tester | 品質管理 |\n| **web-development** | api-designer, backend-dev, frontend-dev, reviewer-be, reviewer-fe | Web アプリ |\n| **mobile-development** | mobile-architect, mobile-ios-dev, mobile-android-dev, mobile-reviewer | モバイルアプリ |\n| **infrastructure** | infra-architect, terraform-dev, k8s-dev, security-auditor | インフラ構築 |\n| **data-engineering** | data-architect, etl-dev, ml-engineer, data-validator | データパイプライン |\n| **devops** | ci-cd-engineer, monitoring-setup, release-manager | 運用自動化 |\n\n### 4.2 カスタムエージェントの追加\n\nプロジェクト固有のエージェントは、ワークフロー設定の `agents.custom` セクションで定義：\n\n```yaml\nagents:\n  include_templates:\n    - core\n    - quality\n  custom:\n    - id: "blockchain-dev"\n      name: "Blockchain Developer"\n      role: implementation\n      capabilities:\n        - write_solidity_contracts\n        - deploy_contracts\n      language_policy:\n        all: "en"\n```\n\n---\n\n## 5. ワークフロー設定\n\n### 5.1 設定ファイル構成\n\nワークフロー設定ファイルは以下の構造を持つ：\n\n```yaml\nversion: "1.0"\n\nproject:\n  name: "プロジェクト名"\n  type: web | mobile | infrastructure | data-pipeline | hybrid | custom\n  language_policy:\n    customer_facing: "ja"\n    development: "en', 'agents:\n  include_templates: [core, quality, web-development]\n  custom: []\n  exclude: []\n\nworkflow:\n  stages:\n    - name: "ステージ名', 'agents: [agent-id-1, agent-id-2]\n      execution_mode: sequential | parallel\n      gate:\n        required_status: OK\n      on_failure: abort | retry | fallback\n  error_handling:\n    retry_policy: {...}\n    circuit_breaker: {...}\n```\n\n完全なスキーマは [schemas/workflow-schema.yaml](schemas/workflow-schema.yaml) を参照。\n\n### 5.2 プロジェクトタイプ別テンプレート\n\n- [templates/web-fullstack.yaml](templates/web-fullstack.yaml) - Web フルスタック開発\n\n追加予定：\n- `templates/mobile-app.yaml` - モバイルアプリ開発\n- `templates/infrastructure.yaml` - インフラ構築\n- `templates/data-pipeline.yaml` - データパイプライン\n\n---\n\n## 6. 役割と責任の定義\n\n### 6.1 責任範囲の3分類\n\n各エージェントは以下の3つのカテゴリで責任を定義：\n\n| 分類 | 説明 |\n|------|------|\n| **must_do** | 必ず実行すべき責務 |\n| **must_not_do** | 絶対に行ってはならない行為 |\n| **may_do** | 状況に応じて実行可能な行為 |\n\n### 6.2 境界定義\n\nファイルアクセスと操作権限を明確に定義：\n\n```yaml\nboundaries:\n  file_patterns:\n    allowed: ["backend/**', 'api/**/*.yaml'], ['frontend/**', '.env*', '**/*.secret'], ['read', 'write', 'execute_tests'], ['deploy', 'delete_production'], ['policies/language-policy.yaml](policies/language-policy.yaml) を参照。\n\n#### 基本ルール\n\n| カテゴリ | 言語 |\n|----------|------|\n| 顧客向けコミュニケーション | 日本語 |\n| 開発内部コミュニケーション | 英語 |\n| コードコメント | 英語 |\n| 技術ドキュメント | 英語 |\n| Git コミットメッセージ | 英語 |\n\n#### エージェント別設定\n\n| エージェント | 顧客向け | 開発内部 |\n|--------------|----------|----------|\n| client-liaison | 日本語 | 日本語 |\n| progress | 日本語 | 英語 |\n| その他開発系 | - | 英語 |\n\n### 7.2 コンテキスト共有\n\nエージェント間で共有するコンテキスト：\n\n```yaml\nshared_context:\n  project_metadata:     # プロジェクト情報\n  api_contract:         # API 契約（Single Source of Truth）\n  current_state:        # 現在の状態\n  completed_stages:     # 完了ステージ\n  pending_issues:       # 未解決の課題\n```\n\nストレージ形式：JSON（`workspace/.context/` 配下）\n\n---\n\n## 8. 実行フロー（状態遷移）\n\n### 8.1 基本フロー\n\n```\n1. Intake（受付）\n   └─ client-liaison が顧客要求を仕様化\n\n2. Requirements Check（要件監査）\n   └─ requirements-auditor が曖昧点を列挙\n\n3. Plan（計画）\n   └─ planner が工程とタスクを定義\n\n4. Contract（契約）\n   └─ api-designer が OpenAPI を生成（Single Source of Truth）\n\n5. Implementation（実装）\n   └─ backend-dev と frontend-dev を並列で実装\n\n6. Review & QA（品質ゲート）\n   └─ reviewer-be / reviewer-fe / tester / quality-auditor を並列で実施\n\n7. Integration（統合）\n   └─ integrator が成果物を統合し完了判定\n\n8. Progress（再計画）\n   └─ NG があれば progress が再実行計画を提案 → 修正ループ\n```\n\n### 8.2 状態\n\n```\nNEW → SPECIFIED → PLANNED → CONTRACT_READY → IMPLEMENTED → QA_PASSED → INTEGRATED → DONE\n                                                ↓                ↓\n                                            FAILED ←←←←←←←←←←←←←←\n```\n\n---\n\n## 9. 入出力設計\n\n### 9.1 共通レスポンススキーマ\n\n全サブエージェントは以下の JSON 形式で応答：\n\n```json\n{\n  "status": "OK | NG', 'summary": "処理内容の簡潔な要約', 'findings": [\n    {\n      "severity": "INFO | WARN | ERROR', 'message": "指摘内容', 'ref": "対象ファイルや行番号', 'suggestion": "改善提案'], [{'path': 'relative/path/to/file', 'type': 'code | spec | doc | config | report', 'desc': '成果物の説明', 'checksum': 'SHA256ハッシュ'}], ['次に行うべき作業'], {}, ['policies/file-policy.yaml](policies/file-policy.yaml) を参照。\n\n#### バックアップファイル禁止\n\n**バックアップファイルは作成しない。** Git 履歴がバージョン管理の役割を果たす。\n\n禁止されるファイルパターン：\n- `*.bak`, `*.backup`, `*.orig`, `*.old`\n- `*.swp`, `*.swo`, `*~`\n- `*.tmp`, `#*#`, `.#*`\n\n#### アトミック操作\n\nファイル更新は一時ファイル経由でアトミックに実行し、部分書き込みによる破損を防止。\n\n#### ファイル命名規則\n\n- ファイル名：kebab-case\n- 最大長：100文字\n- 禁止文字：スペース、`<>:', 10.2, '契約（Contract）最優先ルール\n\n- API 定義（OpenAPI / JSONSchema）は唯一の正解\n- FE / BE は契約から逸脱してはならない\n- 項目の追加・削除・型変更は禁止\n- 変更が必要な場合は必ず `status = NG` として差し戻す\n\n### 10.3 最小変更原則\n\n- 不要なリファクタリングは禁止\n- コメントは必ず保持する\n- 既存の振る舞いを変更しない\n- 依頼された範囲のみを変更する\n\n---\n\n## 11. 信頼性とエラーハンドリング\n\n### 11.1 リトライポリシー\n\n```yaml\nretry_policy:\n  max_attempts: 3\n  backoff_type: exponential\n  initial_delay_ms: 1000\n  max_delay_ms: 60000\n  multiplier: 2.0\n  jitter: true\n  jitter_factor: 0.1\n```\n\n#### エラー分類\n\n| 分類 | コード例 | デフォルトアクション |\n|------|----------|----------------------|\n| 一時的 | TIMEOUT, RATE_LIMITED | リトライ |\n| 永続的 | INVALID_INPUT, CONTRACT_VIOLATION | エスカレーション |\n| 回復可能 | PARTIAL_FAILURE | 部分リトライ |\n\n### 11.2 サーキットブレーカー\n\n連続失敗時に自動的に処理を停止し、システム保護：\n\n```yaml\ncircuit_breaker:\n  failure_threshold: 5      # 5回失敗でオープン\n  success_threshold: 3      # 3回成功でクローズ\n  recovery_timeout_ms: 60000\n```\n\n### 11.3 フォールバック戦略\n\n| 条件 | アクション |\n|------|------------|\n| リトライ上限超過 | オーケストレーターにエスカレート |\n| サーキットオープン | 人間に委譲 |\n| 致命的エラー | ワークフロー中断 |\n\n---\n\n## 12. 並列実行ガイドライン\n\n### 12.1 並列化可能な組み合わせ\n\n| ステージ | エージェント | 条件 |\n|----------|--------------|------|\n| 実装 | backend-dev, frontend-dev | 共有リソースなし |\n| レビュー | reviewer-be, reviewer-fe, tester, quality-auditor | 独立レビュー |\n\n### 12.2 直列化が必須なケース\n\n| 理由 | シーケンス |\n|------|------------|\n| 依存関係 | api-designer → backend-dev |\n| データ依存 | requirements-auditor → planner |\n\n### 12.3 リソースロック\n\n並列実行時のファイル競合を防止：\n\n```yaml\nresource_locking:\n  type: file\n  scope: exclusive\n  timeout_ms: 30000\n```\n\n---\n\n## 13. ログとトレーサビリティ\n\n### 13.1 構造化ログ\n\n```json\n{\n  "timestamp": "2025-01-12T10:00:00Z', 'level": "INFO', 'agent_id": "backend-dev', 'trace_id": "abc123', 'span_id": "def456', 'message": "API implementation completed', 'metadata": {\n    "files_modified', 5, 'tests_passed', 42], ['str]) -> list[AgentConfig]\n    def load_policies(self) -> Policies\n```\n\n---\n\n## 15. 次に作成する成果物\n\n### 優先度：高\n- [ ] `orchestrator_skeleton.py` - 親エージェントの雛形実装\n- [ ] `response_schema.json` - 共通レスポンススキーマ（JSON Schema）\n- [ ] `state_machine.md` - 状態遷移定義の詳細\n\n### 優先度：中\n- [ ] `templates/mobile-app.yaml` - モバイルアプリ開発テンプレート\n- [ ] `templates/infrastructure.yaml` - インフラ構築テンプレート\n- [ ] `agents/` - 各エージェントの詳細定義\n\n### 優先度：低\n- [ ] `examples/` - 使用例\n- [ ] `tests/` - テストケース']]