# Web Fullstack Project Template
# Template for web application development projects with frontend and backend.

version: "1.0"

project:
  name: "Web Fullstack Project"
  type: web
  description: "Full-stack web application with API backend and frontend"
  language_policy:
    customer_facing: "ja"
    development: "en"
    documentation: "en"
    code_comments: "en"
    commit_messages: "en"

agents:
  include_templates:
    - core
    - quality
    - web-development

workflow:
  global_timeout_ms: 7200000  # 2 hours

  stages:
    # Stage 1: Customer Requirements Intake
    - name: "intake"
      description: "Receive and translate customer requirements"
      agents:
        - client-liaison
      execution_mode: sequential
      timeout_ms: 600000  # 10 minutes

    # Stage 2: Requirements Audit
    - name: "requirements-audit"
      description: "Verify requirements completeness and clarity"
      agents:
        - requirements-auditor
      execution_mode: sequential
      gate:
        required_status: OK
        allow_warnings: true
      on_failure: abort
      timeout_ms: 300000

    # Stage 3: Planning
    - name: "planning"
      description: "Create implementation plan and task breakdown"
      agents:
        - planner
      execution_mode: sequential
      gate:
        required_status: OK
      timeout_ms: 300000

    # Stage 4: API Contract Design
    - name: "contract"
      description: "Design and validate API contract (Single Source of Truth)"
      agents:
        - api-designer
      execution_mode: sequential
      gate:
        required_status: OK
        allow_warnings: false
      on_failure: abort
      timeout_ms: 600000

    # Stage 5: Implementation (Parallel)
    - name: "implementation"
      description: "Implement backend and frontend in parallel"
      agents:
        - backend-dev
        - frontend-dev
      execution_mode: parallel
      gate:
        required_status: OK
      on_failure: retry
      timeout_ms: 1800000  # 30 minutes

    # Stage 6: Review and QA (Parallel)
    - name: "review-qa"
      description: "Code review, testing, and quality audit"
      agents:
        - reviewer-be
        - reviewer-fe
        - tester
        - quality-auditor
      execution_mode: parallel
      gate:
        required_status: OK
        allow_warnings: true
        max_errors: 0
      on_failure: retry
      timeout_ms: 900000  # 15 minutes

    # Stage 7: Integration
    - name: "integration"
      description: "Integrate all artifacts and perform final validation"
      agents:
        - integrator
      execution_mode: sequential
      gate:
        required_status: OK
      timeout_ms: 600000

  error_handling:
    retry_policy:
      max_attempts: 3
      backoff_type: exponential
      initial_delay_ms: 2000
      max_delay_ms: 30000
      multiplier: 2.0
      jitter: true
      jitter_factor: 0.1

    circuit_breaker:
      enabled: true
      failure_threshold: 5
      success_threshold: 3
      recovery_timeout_ms: 60000

    fallback_strategies:
      - condition: max_retries_exceeded
        action: escalate_to_orchestrator
      - condition: circuit_open
        action: delegate_to_human
      - condition: critical_failure
        action: abort_workflow
